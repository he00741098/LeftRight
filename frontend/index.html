<!DOCTYPE html>
<html>

<head>
  <title>
    Left Right Sweep!
  </title>
</head>

<body>

  <div id="game">
    <div id="prompt"></div>
    <div id="indicator"></div>
    <div id="buttons">
      <div class="lrbutton" id="leftbutton"></div>
      <div class="lrbutton" id="rightbutton"></div>
    </div>

    <div class="canvascontainer" id="canvasdiv">
      <canvas id="maingame">

      </canvas>
    </div>
  </div>

  <style>
    html,
    body,
    #game {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }

    .canvascontainer {
      width: 80%;
      height: 80%;
      position: absolute;
      left: 10%;
      top: 10%;
      margin: 0;
      padding: 0;
    }

    #maingame {}

    #game {
      display: grid;
      justify-content: center;
    }

    #indicator {
      width: 50px;
      height: 50px;
    }

    #prompt {
      width: 300px;
      height: 50px;
      font-size: 50px;
    }

    .lrbutton {
      width: 300px;
      height: 50px;
    }

    #leftbutton {}
  </style>
  <script>
    let debug_mode = true;
    const valid_pairs = [
      ["a", "d"],
      ["h", "l"],
      ["f", "j"]
    ];
    const valid_left_prompts = ["L", "l", "left", "Left", "<", "<="];
    const valid_right_prompts = ["R", "r", "right", "Right", ">", "=>"];
    const valid_sweep_prompts = ["Sweep!"];

    const prompt = document.getElementById("prompt");
    const indicator = document.getElementById("indicator");
    const canvas = document.getElementById("maingame");
    var now;
    var current_pair = null;
    var current_direction = -1;
    var directions = [-1, -1, -1, -1, -1, -1, -1, -1];
    var current_direction_index = 0;

    function canvas_resize() {
      let rect = document.getElementById("canvasdiv").getBoundingClientRect();
      canvas.height = rect.height;
      canvas.width = rect.width;
    }
    // implement mechanics - check if a player has entered a key and send it to a centralized proccessor.
    //function that proccesses the keypress events
    let proccessor = function (event) {
      // log(event.key);
      //left right proccessor
      if (current_pair == null) {
        for (var pair of valid_pairs) {
          if (event.key == pair[0]) {
            document.dispatchEvent(new Event("left"));
            current_pair = pair;
            break;
          } else if (event.key == pair[1]) {
            document.dispatchEvent(new Event("right"));
            current_pair = pair;
            break;
          } else if (event.key == " ") {
            //space
            document.dispatchEvent(new Event("sweep"));
            continue;
          } else {
            continue;
          }
        }
      } else {
        if (event.key == current_pair[0]) {
          document.dispatchEvent(new Event("left"));
        } else if (event.key == current_pair[1]) {
          document.dispatchEvent(new Event("right"));
        } else if (event.key == " ") {
          document.dispatchEvent(new Event("sweep"));
        } else {
          log("not a valid key");
        }
      }

    };
    //Initates the event listeners
    function initiate_listeners() {
      document.addEventListener("keypress", proccessor);
      window.addEventListener("resize", canvas_resize);
    }
    //function that replaces console.log--only logs when in debug mode
    function log(event) {
      if (debug_mode) {
        console.log(event);
      }
    }
    //proceed with game initialization.
    var left_func = function () {
      time_elapsed();
      if (current_direction == 0) {
        // log("Correct Left");
        trigger_correct();
      } else {
        // log("Incorrect Left");
        trigger_incorrect();
      }
      change_direction();
    };
    var right_func = function () {
      time_elapsed();
      if (current_direction == 1) {
        // log("Correct Right");
        trigger_correct();
      } else {
        // log("Incorrect Right");
        trigger_incorrect();
      }
      change_direction();
    };
    var sweep_func = function () {
      time_elapsed();
      if (current_direction == 2) {
        // log("Correct Sweep");
        trigger_correct();
      } else {
        // log("Incorrect Sweep");
        trigger_incorrect();
      }
      change_direction();
    };
    function time_elapsed() {
      let new_new = performance.now();
      log("Time elapsed: " + (new_new - now) + " ms");
      now = new_new;
    }

    function trigger_correct() {
      indicator.style.backgroundColor = "green";
    }
    function trigger_incorrect() {
      indicator.style.backgroundColor = "red";

    }
    function initiate_game() {
      now = performance.now();
      document.addEventListener("left", (event) => {left_func()});
      document.addEventListener("right", (event) => {right_func()});
      document.addEventListener("sweep", (event) => {sweep_func()});
      generate_direction_set();
      change_direction();
    }
    function change_direction() {

      if (current_direction == -1) {
        let random = Math.floor(Math.random() * 3);
        if (random == 0) {
          //left
          display_left();
        } else if (random == 1) {
          //right
          display_right();
        } else if (random == 2) {
          display_sweep();
        } else {
          log("something went massively wrong!!!!")
          alert("Undefined behavior");
          return;
        }
      } else {
        let random = Math.floor(Math.random() * 2);
        //large switch statement to prevent duplicate rights...
        switch (current_direction) {
          case 0:
            switch (random) {
              case 0:
                display_right();
                break;
              case 1:
                display_sweep();
                break;
            }
            break;
          case 1:
            switch (random) {
              case 0:
                display_left();
                break;
              case 1:
                display_sweep();
                break;
            }
            break;
          case 2:
            switch (random) {
              case 0:
                display_left();
                break;
              case 1:
                display_right();
                break;
            }
            break;
        }
      }
    }
    function display_left() {
      current_direction = 0;
      prompt.innerText = "Left";
    }
    function display_right() {
      current_direction = 1;
      prompt.innerText = "Right";
    }
    function display_sweep() {
      current_direction = 2;
      prompt.innerText = "Sweep!";
    }

    function generate_direction_set() {
      for (var i = 0; i < directions.length; i++) {
        let random = Math.floor(Math.random() * 3);
        directions[i] = random;
      }
    }
    function regenerate_direction_set(second_half) {
      if (!second_half) {
        for (var i = 0; i < directions.length / 2; i++) {
          let random = Math.floor(Math.random() * 3);
          directions[i] = random;
        }
      } else {
        for (var i = 4; i < directions.length; i++) {
          let random = Math.floor(Math.random() * 3);
          directions[i] = random;
        }
      }
    }

    if (debug_mode) {
      // document.addEventListener("left", (event) => {log("left event")});
      // document.addEventListener("right", (event) => {log("right event")});
    }
    initiate_listeners();
    canvas_resize();
    initiate_game();
  </script>
</body>

</html>
